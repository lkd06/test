<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-/mybatis.org/DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="membermapper">

	<insert id="insertData" parameterType="com.exe.dto.MemberDTO">
		insert into users(phone, pw, salt, name, birth, TmemberGrade, email, point) 
		values(#{phone},#{pw},#{salt},#{name},#{birth},'nothing',#{email},0)
	</insert>
	
	<select id="findSalt" parameterType="String" resultType="String">
		select salt from users where phone=to_char(#{phone})
	</select>

	<select id="getOneData" parameterType="com.exe.dto.MemberDTO" resultType="com.exe.dto.MemberDTO">
		select phone,pw,salt,name,point,admin,priceNum from users where (phone=to_char(#{phone})) and (pw=to_char(#{pw}))
	</select>
	
	<select id="findMemInfo" parameterType="String" resultType="com.exe.dto.MemberDTO">
		select u.phone phone ,u.pw pw,u.name name, u.email email,u.birth birth
			,u.TmemberGrade TmemberGrade,u.point point,u.priceNum priceNum,p.subject priceName
		from users u,price p
		where phone=to_char(#{phone}) and p.num=u.priceNum
	</select>

	<!-- 1120 -->
	<delete id="deleteMem" parameterType="String">
		delete users where phone=to_char(#{phone})
	</delete>
	
	<update id="updateMem" parameterType="com.exe.dto.MemberDTO">
		update users set pw=#{pw},email=#{email},name=#{name},birth=#{birth},salt=#{salt} where phone=#{phone}
	</update>
	
	<select id="phoneCheck" resultType="int" parameterType="String">
		select nvl(count(phone),0) from users where phone=to_char(#{phone})
	</select>
	
	<update id="addPoint" parameterType="com.exe.dto.MemberDTO">
		update users set point=point+#{point} where phone=to_char(#{phone})
	</update>
	
	<select id="getReadData" parameterType="com.exe.dto.MemberDTO" resultType="com.exe.dto.MemberDTO">
		select phone,salt,birth,name,point,TmemberGrade,email,admin from users where phone=to_char(#{phone})
	</select>
	
	<select id="getLists" resultType="com.exe.dto.MemberDTO" parameterType="map">
		select phone,pw,name,birth,email,TmemberGrade,point,admin from users
	</select>
	
	<select id="findForPw" resultType="com.exe.dto.MemberDTO" parameterType="map">
		select phone,pw,email,name,birth from users where phone=#{phone}
	</select>
</mapper>